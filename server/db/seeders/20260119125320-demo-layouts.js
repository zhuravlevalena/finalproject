'use strict';

/** @type {import('sequelize-cli').Migration} */
module.exports = {
  async up(queryInterface, Sequelize) {
    const templates = await queryInterface.sequelize.query(
      `SELECT id, name, "isDefault" FROM "Templates" ORDER BY id;`,
      { type: Sequelize.QueryTypes.SELECT },
    );

    console.log(
      `[Seeder] Found ${templates.length} templates:`,
      templates.map((t) => ({ id: t.id, name: t.name })),
    );

    if (templates.length === 0) {
      console.log('No templates found. Please seed templates first.');
      return;
    }

    const now = new Date();
    const layouts = [];

    templates.forEach((template) => {
      console.log(
        `[Seeder] Creating layouts for template ${template.id} (${template.name}), isDefault=${template.isDefault}`,
      );

      if (template.isDefault) {
        // 1. УНИВЕРСАЛЬНЫЙ МАКЕТ: "ELEGANT GRADIENT"
        layouts.push({
          name: 'Elegant Gradient',
          description: 'Элегантный градиентный макет с акцентом на продукт',
          templateId: template.id,
          canvasData: JSON.stringify({
            version: '5.3.0',
            objects: [
              // Градиентный фон
              {
                type: 'rect',
                left: 0,
                top: 0,
                width: 900,
                height: 600,
                fill: '#667EEA',
                selectable: false,
                evented: false,
              },
              {
                type: 'rect',
                left: 0,
                top: 600,
                width: 900,
                height: 600,
                fill: '#764BA2',
                selectable: false,
                evented: false,
              },
              // Декоративные круги
              {
                type: 'circle',
                left: -100,
                top: -100,
                radius: 200,
                fill: 'rgba(255, 255, 255, 0.1)',
                selectable: false,
                evented: false,
              },
              {
                type: 'circle',
                left: 700,
                top: 900,
                radius: 250,
                fill: 'rgba(255, 255, 255, 0.08)',
                selectable: false,
                evented: false,
              },
              // Основной заголовок
              {
                type: 'textbox',
                left: 50,
                top: 950,
                width: 800,
                fontSize: 48,
                fontFamily: 'Arial',
                fontWeight: 'bold',
                fill: '#FFFFFF',
                text: 'НАЗВАНИЕ ТОВАРА',
                textAlign: 'left',
                selectable: true,
                evented: true,
              },
              // Описание
              {
                type: 'textbox',
                left: 50,
                top: 1020,
                width: 800,
                fontSize: 22,
                fontFamily: 'Arial',
                fill: 'rgba(255, 255, 255, 0.9)',
                text: 'Высокое качество • Современный дизайн',
                textAlign: 'left',
                selectable: true,
                evented: true,
              },
            ],
          }),
          preview: null,
          isDefault: false,
          createdAt: now,
          updatedAt: now,
        });

        // 2. УНИВЕРСАЛЬНЫЙ МАКЕТ: "MINIMAL LUXURY"
        layouts.push({
          name: 'Minimal Luxury',
          description: 'Минималистичный макет с крупной типографикой',
          templateId: template.id,
          canvasData: JSON.stringify({
            version: '5.3.0',
            objects: [
              // Белый фон
              {
                type: 'rect',
                left: 0,
                top: 0,
                width: 900,
                height: 1200,
                fill: '#FFFFFF',
                selectable: false,
                evented: false,
              },
              // Тонкая рамка
              {
                type: 'rect',
                left: 40,
                top: 40,
                width: 820,
                height: 1120,
                fill: 'transparent',
                stroke: '#000000',
                strokeWidth: 2,
                selectable: false,
                evented: false,
              },
              // Декоративная линия сверху
              {
                type: 'rect',
                left: 80,
                top: 80,
                width: 150,
                height: 4,
                fill: '#000000',
                selectable: true,
                evented: true,
              },
              // Категория
              {
                type: 'textbox',
                left: 80,
                top: 100,
                width: 740,
                fontSize: 16,
                fontFamily: 'Arial',
                fill: '#666666',
                text: 'КОЛЛЕКЦИЯ 2026',
                textAlign: 'left',
                charSpacing: 200,
                selectable: true,
                evented: true,
              },
              // Основной заголовок
              {
                type: 'textbox',
                left: 80,
                top: 950,
                width: 740,
                fontSize: 52,
                fontFamily: 'Georgia, serif',
                fontWeight: 'bold',
                fill: '#000000',
                text: 'НАЗВАНИЕ\nТОВАРА',
                textAlign: 'left',
                selectable: true,
                evented: true,
              },
              // Описание
              {
                type: 'textbox',
                left: 80,
                top: 1070,
                width: 740,
                fontSize: 18,
                fontFamily: 'Arial',
                fill: '#666666',
                text: 'Эксклюзивное качество\nПремиальные материалы',
                textAlign: 'left',
                selectable: true,
                evented: true,
              },
            ],
          }),
          preview: null,
          isDefault: false,
          createdAt: now,
          updatedAt: now,
        });

        // 3. УНИВЕРСАЛЬНЫЙ МАКЕТ: "MODERN BOLD"
        layouts.push({
          name: 'Modern Bold',
          description: 'Яркий современный макет с геометрическими элементами',
          templateId: template.id,
          canvasData: JSON.stringify({
            version: '5.3.0',
            objects: [
              // Темный фон
              {
                type: 'rect',
                left: 0,
                top: 0,
                width: 900,
                height: 1200,
                fill: '#1A1A2E',
                selectable: false,
                evented: false,
              },
              // Яркий акцентный блок
              {
                type: 'rect',
                left: 0,
                top: 0,
                width: 900,
                height: 300,
                fill: '#FF6B6B',
                selectable: false,
                evented: false,
              },
              // Диагональный элемент
              {
                type: 'rect',
                left: -200,
                top: 200,
                width: 1300,
                height: 200,
                fill: '#4ECDC4',
                angle: -15,
                selectable: false,
                evented: false,
              },
              // Бейдж "NEW"
              {
                type: 'rect',
                left: 50,
                top: 50,
                width: 120,
                height: 50,
                fill: '#FFFFFF',
                rx: 5,
                ry: 5,
                selectable: true,
                evented: true,
              },
              {
                type: 'textbox',
                left: 50,
                top: 62,
                width: 120,
                fontSize: 20,
                fontFamily: 'Arial',
                fontWeight: 'bold',
                fill: '#1A1A2E',
                text: 'NEW',
                textAlign: 'center',
                selectable: true,
                evented: true,
              },
              // Основной заголовок
              {
                type: 'textbox',
                left: 50,
                top: 900,
                width: 800,
                fontSize: 56,
                fontFamily: 'Impact, Arial',
                fill: '#FFFFFF',
                text: 'НАЗВАНИЕ ТОВАРА',
                textAlign: 'left',
                selectable: true,
                evented: true,
              },
              // Особенности
              {
                type: 'textbox',
                left: 50,
                top: 990,
                width: 800,
                fontSize: 20,
                fontFamily: 'Arial',
                fill: '#4ECDC4',
                text: '✓ Инновационный дизайн  ✓ Высокое качество  ✓ Гарантия',
                textAlign: 'left',
                selectable: true,
                evented: true,
              },
            ],
          }),
          preview: null,
          isDefault: false,
          createdAt: now,
          updatedAt: now,
        });
      } else {
        // Категорийные макеты
        if (template.name === 'Дом и интерьер') {
          // МАКЕТ ДЛЯ ЛАМПЫ
          layouts.push({
            name: 'Интерьерная лампа',
            description: 'Стильный макет для освещения и декора',
            templateId: template.id,
            canvasData: JSON.stringify({
              version: '5.3.0',
              objects: [
                // Светлый фон с градиентом
                {
                  type: 'rect',
                  left: 0,
                  top: 0,
                  width: 900,
                  height: 600,
                  fill: '#F8F9FA',
                  selectable: false,
                  evented: false,
                },
                {
                  type: 'rect',
                  left: 0,
                  top: 600,
                  width: 900,
                  height: 600,
                  fill: '#E9ECEF',
                  selectable: false,
                  evented: false,
                },
                // Декоративный круг (имитация света)
                {
                  type: 'circle',
                  left: 250,
                  top: 150,
                  radius: 180,
                  fill: 'rgba(255, 223, 186, 0.3)',
                  selectable: false,
                  evented: false,
                },
                {
                  type: 'circle',
                  left: 300,
                  top: 200,
                  radius: 120,
                  fill: 'rgba(255, 223, 186, 0.5)',
                  selectable: false,
                  evented: false,
                },
                // Изображение лампы
                {
                  type: 'image',
                  left: 200,
                  top: 250,
                  width: 500,
                  height: 500,
                  src: '/uploads/lamp.png',
                  selectable: true,
                  evented: true,
                },
                // Бейдж "ДИЗАЙН"
                {
                  type: 'rect',
                  left: 50,
                  top: 50,
                  width: 180,
                  height: 60,
                  fill: '#495057',
                  rx: 30,
                  ry: 30,
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'textbox',
                  left: 50,
                  top: 65,
                  width: 180,
                  fontSize: 18,
                  fontFamily: 'Arial',
                  fontWeight: 'bold',
                  fill: '#FFFFFF',
                  text: 'ДИЗАЙН',
                  textAlign: 'center',
                  selectable: true,
                  evented: true,
                },
                // Название
                {
                  type: 'textbox',
                  left: 50,
                  top: 850,
                  width: 800,
                  fontSize: 48,
                  fontFamily: 'Georgia, serif',
                  fontWeight: 'bold',
                  fill: '#212529',
                  text: 'НАСТОЛЬНАЯ ЛАМПА',
                  textAlign: 'left',
                  selectable: true,
                  evented: true,
                },
                // Характеристики
                {
                  type: 'textbox',
                  left: 50,
                  top: 920,
                  width: 800,
                  fontSize: 20,
                  fontFamily: 'Arial',
                  fill: '#6C757D',
                  text: '• Регулируемая яркость\n• Энергосберегающая LED\n• Современный скандинавский дизайн',
                  textAlign: 'left',
                  selectable: true,
                  evented: true,
                },
                // Артикул
                {
                  type: 'textbox',
                  left: 50,
                  top: 1070,
                  width: 400,
                  fontSize: 24,
                  fontFamily: 'Arial',
                  fill: '#ADB5BD',
                  text: 'Арт. LAMP-2026-001',
                  textAlign: 'left',
                  selectable: true,
                  evented: true,
                },
              ],
            }),
            preview: null,
            isDefault: false,
            createdAt: now,
            updatedAt: now,
          });
        } else if (template.name === 'Косметика и уход') {
          // МАКЕТ ДЛЯ КРЕМА
          layouts.push({
            name: 'Крем для лица',
            description: 'Элегантный макет для косметики',
            templateId: template.id,
            canvasData: JSON.stringify({
              version: '5.3.0',
              objects: [
                // Нежный градиентный фон
                {
                  type: 'rect',
                  left: 0,
                  top: 0,
                  width: 900,
                  height: 600,
                  fill: '#FFF5F7',
                  selectable: false,
                  evented: false,
                },
                {
                  type: 'rect',
                  left: 0,
                  top: 600,
                  width: 900,
                  height: 600,
                  fill: '#FFE8EC',
                  selectable: false,
                  evented: false,
                },
                // Декоративные круги (мягкие)
                {
                  type: 'circle',
                  left: 600,
                  top: 100,
                  radius: 150,
                  fill: 'rgba(255, 192, 203, 0.2)',
                  selectable: false,
                  evented: false,
                },
                {
                  type: 'circle',
                  left: 100,
                  top: 900,
                  radius: 120,
                  fill: 'rgba(255, 192, 203, 0.15)',
                  selectable: false,
                  evented: false,
                },
                // Изображение крема
                {
                  type: 'image',
                  left: 200,
                  top: 250,
                  width: 500,
                  height: 500,
                  src: '/uploads/cream.png',
                  selectable: true,
                  evented: true,
                },
                // Бейдж "УХОД"
                {
                  type: 'rect',
                  left: 50,
                  top: 50,
                  width: 160,
                  height: 55,
                  fill: '#D4A5A5',
                  rx: 27,
                  ry: 27,
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'textbox',
                  left: 50,
                  top: 64,
                  width: 160,
                  fontSize: 17,
                  fontFamily: 'Arial',
                  fontWeight: 'bold',
                  fill: '#FFFFFF',
                  text: 'УХОД',
                  textAlign: 'center',
                  selectable: true,
                  evented: true,
                },
                // Название
                {
                  type: 'textbox',
                  left: 50,
                  top: 850,
                  width: 800,
                  fontSize: 46,
                  fontFamily: 'Georgia, serif',
                  fontWeight: 'bold',
                  fill: '#8B4C5C',
                  text: 'УВЛАЖНЯЮЩИЙ КРЕМ',
                  textAlign: 'left',
                  selectable: true,
                  evented: true,
                },
                // Подзаголовок
                {
                  type: 'textbox',
                  left: 50,
                  top: 915,
                  width: 800,
                  fontSize: 22,
                  fontFamily: 'Arial',
                  fill: '#A67C8A',
                  text: 'С гиалуроновой кислотой и витамином E',
                  textAlign: 'left',
                  selectable: true,
                  evented: true,
                },
                // Преимущества
                {
                  type: 'textbox',
                  left: 50,
                  top: 970,
                  width: 800,
                  fontSize: 18,
                  fontFamily: 'Arial',
                  fill: '#B08B96',
                  text: '✓ Глубокое увлажнение 24ч  ✓ Натуральный состав  ✓ Для всех типов кожи',
                  textAlign: 'left',
                  selectable: true,
                  evented: true,
                },
                // Объем
                {
                  type: 'textbox',
                  left: 50,
                  top: 1070,
                  width: 400,
                  fontSize: 28,
                  fontFamily: 'Arial',
                  fontWeight: 'bold',
                  fill: '#8B4C5C',
                  text: '50 мл',
                  textAlign: 'left',
                  selectable: true,
                  evented: true,
                },
              ],
            }),
            preview: null,
            isDefault: false,
            createdAt: now,
            updatedAt: now,
          });
        } else if (template.name === 'Одежда и обувь') {
          // МАКЕТ ДЛЯ КРОССОВОК
          layouts.push({
            name: 'Спортивные кроссовки',
            description: 'Динамичный макет для спортивной обуви',
            templateId: template.id,
            canvasData: JSON.stringify({
              version: '5.3.0',
              objects: [
                // Динамичный фон
                {
                  type: 'rect',
                  left: 0,
                  top: 0,
                  width: 900,
                  height: 1200,
                  fill: '#F0F4F8',
                  selectable: false,
                  evented: false,
                },
                // Диагональные полосы (динамика)
                {
                  type: 'rect',
                  left: -100,
                  top: 100,
                  width: 1100,
                  height: 150,
                  fill: '#3B82F6',
                  angle: -10,
                  opacity: 0.8,
                  selectable: false,
                  evented: false,
                },
                {
                  type: 'rect',
                  left: -100,
                  top: 300,
                  width: 1100,
                  height: 100,
                  fill: '#60A5FA',
                  angle: -10,
                  opacity: 0.6,
                  selectable: false,
                  evented: false,
                },
                // Изображение кроссовок
                {
                  type: 'image',
                  left: 150,
                  top: 300,
                  width: 600,
                  height: 450,
                  src: '/uploads/shoes.png',
                  selectable: true,
                  evented: true,
                },
                // Бейдж "SPORT"
                {
                  type: 'rect',
                  left: 50,
                  top: 50,
                  width: 150,
                  height: 55,
                  fill: '#1E40AF',
                  rx: 5,
                  ry: 5,
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'textbox',
                  left: 50,
                  top: 64,
                  width: 150,
                  fontSize: 20,
                  fontFamily: 'Arial',
                  fontWeight: 'bold',
                  fill: '#FFFFFF',
                  text: 'SPORT',
                  textAlign: 'center',
                  selectable: true,
                  evented: true,
                },
                // Название модели
                {
                  type: 'textbox',
                  left: 50,
                  top: 820,
                  width: 800,
                  fontSize: 52,
                  fontFamily: 'Impact, Arial',
                  fill: '#1E293B',
                  text: 'AIR RUNNER PRO',
                  textAlign: 'left',
                  selectable: true,
                  evented: true,
                },
                // Технологии
                {
                  type: 'textbox',
                  left: 50,
                  top: 890,
                  width: 800,
                  fontSize: 20,
                  fontFamily: 'Arial',
                  fill: '#3B82F6',
                  text: 'AIR CUSHION • BREATHABLE MESH • FLEX SOLE',
                  textAlign: 'left',
                  charSpacing: 100,
                  selectable: true,
                  evented: true,
                },
                // Характеристики в блоках
                {
                  type: 'rect',
                  left: 50,
                  top: 950,
                  width: 180,
                  height: 80,
                  fill: '#FFFFFF',
                  stroke: '#E2E8F0',
                  strokeWidth: 2,
                  rx: 10,
                  ry: 10,
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'textbox',
                  left: 50,
                  top: 960,
                  width: 180,
                  fontSize: 16,
                  fontFamily: 'Arial',
                  fill: '#64748B',
                  text: 'ВЕС',
                  textAlign: 'center',
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'textbox',
                  left: 50,
                  top: 985,
                  width: 180,
                  fontSize: 24,
                  fontFamily: 'Arial',
                  fontWeight: 'bold',
                  fill: '#1E293B',
                  text: '280г',
                  textAlign: 'center',
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'rect',
                  left: 250,
                  top: 950,
                  width: 180,
                  height: 80,
                  fill: '#FFFFFF',
                  stroke: '#E2E8F0',
                  strokeWidth: 2,
                  rx: 10,
                  ry: 10,
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'textbox',
                  left: 250,
                  top: 960,
                  width: 180,
                  fontSize: 16,
                  fontFamily: 'Arial',
                  fill: '#64748B',
                  text: 'РАЗМЕРЫ',
                  textAlign: 'center',
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'textbox',
                  left: 250,
                  top: 985,
                  width: 180,
                  fontSize: 24,
                  fontFamily: 'Arial',
                  fontWeight: 'bold',
                  fill: '#1E293B',
                  text: '36-45',
                  textAlign: 'center',
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'rect',
                  left: 450,
                  top: 950,
                  width: 180,
                  height: 80,
                  fill: '#FFFFFF',
                  stroke: '#E2E8F0',
                  strokeWidth: 2,
                  rx: 10,
                  ry: 10,
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'textbox',
                  left: 450,
                  top: 960,
                  width: 180,
                  fontSize: 16,
                  fontFamily: 'Arial',
                  fill: '#64748B',
                  text: 'МАТЕРИАЛ',
                  textAlign: 'center',
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'textbox',
                  left: 450,
                  top: 985,
                  width: 180,
                  fontSize: 24,
                  fontFamily: 'Arial',
                  fontWeight: 'bold',
                  fill: '#1E293B',
                  text: 'MESH',
                  textAlign: 'center',
                  selectable: true,
                  evented: true,
                },
              ],
            }),
            preview: null,
            isDefault: false,
            createdAt: now,
            updatedAt: now,
          });
        } else {
          // Для остальных категорий - базовый макет
          layouts.push({
            name: `${template.name} — базовый макет`,
            description: `Базовый макет для категории "${template.name}"`,
            templateId: template.id,
            canvasData: JSON.stringify({
              version: '5.3.0',
              objects: [
                {
                  type: 'rect',
                  left: 0,
                  top: 0,
                  width: 900,
                  height: 1200,
                  fill: '#ffffff',
                  selectable: false,
                  evented: false,
                },
                {
                  type: 'textbox',
                  left: 50,
                  top: 80,
                  width: 800,
                  fontSize: 56,
                  fontFamily: 'Arial',
                  fontWeight: 'bold',
                  fill: '#000000',
                  text: template.name,
                  textAlign: 'center',
                  selectable: true,
                  evented: true,
                },
                {
                  type: 'textbox',
                  left: 50,
                  top: 950,
                  width: 800,
                  fontSize: 48,
                  fontFamily: 'Arial',
                  fill: '#333333',
                  text: 'Название товара',
                  textAlign: 'center',
                  selectable: true,
                  evented: true,
                },
              ],
            }),
            preview: null,
            isDefault: false,
            createdAt: now,
            updatedAt: now,
          });
        }
      }
    });

    console.log(
      `[Seeder] Creating ${layouts.length} layouts for ${templates.length} templates`,
    );
    if (layouts.length > 0) {
      await queryInterface.bulkInsert('Layouts', layouts, {});
      console.log(`[Seeder] Successfully created ${layouts.length} layouts`);
    } else {
      console.log('[Seeder] No layouts to create!');
    }
  },

  async down(queryInterface) {
    await queryInterface.bulkDelete('Layouts', null, {});
  },
};
