{"version":3,"file":"index.mjs","sources":["../../../extensions/data_updaters/origins/index.ts"],"sourcesContent":["import {\n  Point,\n  FabricImage,\n  Group,\n  BaseFabricObject,\n  type FabricObject,\n  type TOriginX,\n  type TOriginY,\n} from 'fabric';\n\n/**\n * Updates the fromObject function of a class to return a version that can restore old data\n * with values of originX and originY that are different from 'center', 'center'\n * Used to upgrade from fabric 6 to fabric 7\n * @param originalFn the original fromObject function of an object,\n * @param defaultOriginX optional default value for non exported originX,\n * @param defaultOriginY optional default value for non exported originY,\n * @returns a wrapped fromObject function for the object\n */\nexport const originUpdaterWrapper = <T extends FabricObject = FabricObject>(\n  originalFn: (...args: any[]) => Promise<T>,\n  defaultOriginX: TOriginX = 'left',\n  defaultOriginY: TOriginY = 'top',\n): ((...args: any[]) => Promise<T>) =>\n  async function (this: T, serializedObject, ...args) {\n    // we default to left and top because those are defaults before deprecation\n    const { originX = defaultOriginX, originY = defaultOriginY } =\n      serializedObject;\n    // and we do not want to pass those properties on the object anymore\n    delete serializedObject.originX;\n    delete serializedObject.originY;\n    const originalObject = await originalFn.call(\n      this,\n      serializedObject,\n      ...args,\n    );\n    const actualPosition = new Point(originalObject.left, originalObject.top);\n    originalObject.setPositionByOrigin(actualPosition, originX, originY);\n    return originalObject;\n  };\n\n/**\n * Wraps and override the current fabricJS fromObject static functions\n * Used to upgrade from fabric 7 to fabric 8\n * If you used to export with includeDefaultValues = false, you have to specify\n * which were yours default origins values\n * @param originX optional default value for non exported originX,\n * @param originY optional default value for non exported originY,\n */\nexport const installOriginWrapperUpdater = (\n  originX?: TOriginX,\n  originY?: TOriginY,\n) => {\n  // @ts-expect-error the _fromObject parameter could be instantiated differently\n  BaseFabricObject._fromObject = originUpdaterWrapper(\n    BaseFabricObject._fromObject,\n    originX,\n    originY,\n  );\n  // FabricImage and Group do not use _fromObject\n  FabricImage.fromObject = originUpdaterWrapper<FabricImage>(\n    FabricImage.fromObject,\n    originX,\n    originY,\n  );\n  Group.fromObject = originUpdaterWrapper<Group>(\n    Group.fromObject,\n    originX,\n    originY,\n  );\n};\n"],"names":["originUpdaterWrapper","originalFn","defaultOriginX","arguments","length","undefined","defaultOriginY","serializedObject","originX","originY","_len","args","Array","_key","originalObject","call","actualPosition","Point","left","top","setPositionByOrigin","installOriginWrapperUpdater","BaseFabricObject","_fromObject","FabricImage","fromObject","Group"],"mappings":";;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMA,oBAAoB,GAAG,UAClCC,UAA0C,EAAA;AAAA,EAAA,IAC1CC,cAAwB,GAAAC,SAAA,CAAAC,MAAA,GAAA,CAAA,IAAAD,SAAA,CAAA,CAAA,CAAA,KAAAE,SAAA,GAAAF,SAAA,CAAA,CAAA,CAAA,GAAG,MAAM;AAAA,EAAA,IACjCG,cAAwB,GAAAH,SAAA,CAAAC,MAAA,GAAA,CAAA,IAAAD,SAAA,CAAA,CAAA,CAAA,KAAAE,SAAA,GAAAF,SAAA,CAAA,CAAA,CAAA,GAAG,KAAK;EAAA,OAEhC,gBAAyBI,gBAAgB,EAAW;AAClD;IACA,MAAM;AAAEC,MAAAA,OAAO,GAAGN,cAAc;AAAEO,MAAAA,OAAO,GAAGH;AAAe,KAAC,GAC1DC,gBAAgB;AAClB;IACA,OAAOA,gBAAgB,CAACC,OAAO;IAC/B,OAAOD,gBAAgB,CAACE,OAAO;IAAC,KAAA,IAAAC,IAAA,GAAAP,SAAA,CAAAC,MAAA,EANYO,IAAI,OAAAC,KAAA,CAAAF,IAAA,GAAA,CAAA,GAAAA,IAAA,WAAAG,IAAA,GAAA,CAAA,EAAAA,IAAA,GAAAH,IAAA,EAAAG,IAAA,EAAA,EAAA;AAAJF,MAAAA,IAAI,CAAAE,IAAA,GAAA,CAAA,CAAA,GAAAV,SAAA,CAAAU,IAAA,CAAA;AAAA,IAAA;AAOhD,IAAA,MAAMC,cAAc,GAAG,MAAMb,UAAU,CAACc,IAAI,CAC1C,IAAI,EACJR,gBAAgB,EAChB,GAAGI,IACL,CAAC;AACD,IAAA,MAAMK,cAAc,GAAG,IAAIC,KAAK,CAACH,cAAc,CAACI,IAAI,EAAEJ,cAAc,CAACK,GAAG,CAAC;IACzEL,cAAc,CAACM,mBAAmB,CAACJ,cAAc,EAAER,OAAO,EAAEC,OAAO,CAAC;AACpE,IAAA,OAAOK,cAAc;EACvB,CAAC;AAAA;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACaO,2BAA2B,GAAGA,CACzCb,OAAkB,EAClBC,OAAkB,KACf;AACH;AACAa,EAAAA,gBAAgB,CAACC,WAAW,GAAGvB,oBAAoB,CACjDsB,gBAAgB,CAACC,WAAW,EAC5Bf,OAAO,EACPC,OACF,CAAC;AACD;AACAe,EAAAA,WAAW,CAACC,UAAU,GAAGzB,oBAAoB,CAC3CwB,WAAW,CAACC,UAAU,EACtBjB,OAAO,EACPC,OACF,CAAC;AACDiB,EAAAA,KAAK,CAACD,UAAU,GAAGzB,oBAAoB,CACrC0B,KAAK,CAACD,UAAU,EAChBjB,OAAO,EACPC,OACF,CAAC;AACH;;;;"}