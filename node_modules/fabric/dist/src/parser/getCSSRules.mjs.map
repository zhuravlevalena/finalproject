{"version":3,"file":"getCSSRules.mjs","sources":["../../../src/parser/getCSSRules.ts"],"sourcesContent":["import type { CSSRules } from './typedefs';\n\n/**\n * Returns CSS rules for a given SVG document\n * @param {HTMLElement} doc SVG document to parse\n * @return {Object} CSS rules of this document\n */\nexport function getCSSRules(doc: Document) {\n  const styles = doc.getElementsByTagName('style');\n  const allRules: CSSRules = {};\n\n  // very crude parsing of style contents\n  for (let i = 0; i < styles.length; i++) {\n    const styleContents = (styles[i].textContent || '').replace(\n      // remove comments\n      /\\/\\*[\\s\\S]*?\\*\\//g,\n      '',\n    );\n\n    if (styleContents.trim() === '') {\n      continue;\n    }\n    // recovers all the rule in this form `body { style code... }`\n    // rules = styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);\n    styleContents\n      .split('}')\n      // remove empty rules and remove everything if we didn't split in at least 2 pieces\n      .filter((rule, index, array) => array.length > 1 && rule.trim())\n      // at this point we have hopefully an array of rules `body { style code... `\n      .forEach((rule) => {\n        // if there is more than one opening bracket and the rule starts with '@', it is likely\n        // a nested at-rule like @media, @supports, @scope, etc. Ignore these as the code below\n        // can not handle it.\n        if (\n          (rule.match(/{/g) || []).length > 1 &&\n          rule.trim().startsWith('@')\n        ) {\n          return;\n        }\n\n        const match = rule.split('{'),\n          ruleObj: Record<string, string> = {},\n          declaration = match[1].trim(),\n          propertyValuePairs = declaration.split(';').filter(function (pair) {\n            return pair.trim();\n          });\n\n        for (let j = 0; j < propertyValuePairs.length; j++) {\n          const pair = propertyValuePairs[j].split(':'),\n            property = pair[0].trim(),\n            value = pair[1].trim();\n          ruleObj[property] = value;\n        }\n        rule = match[0].trim();\n        rule.split(',').forEach((_rule) => {\n          _rule = _rule.replace(/^svg/i, '').trim();\n          if (_rule === '') {\n            return;\n          }\n          allRules[_rule] = {\n            ...(allRules[_rule] || {}),\n            ...ruleObj,\n          };\n        });\n      });\n  }\n  return allRules;\n}\n"],"names":["getCSSRules","doc","styles","getElementsByTagName","allRules","i","length","styleContents","textContent","replace","trim","split","filter","rule","index","array","forEach","match","startsWith","ruleObj","declaration","propertyValuePairs","pair","j","property","value","_rule"],"mappings":"AAEA;AACA;AACA;AACA;AACA;AACO,SAASA,WAAWA,CAACC,GAAa,EAAE;AACzC,EAAA,MAAMC,MAAM,GAAGD,GAAG,CAACE,oBAAoB,CAAC,OAAO,CAAC;EAChD,MAAMC,QAAkB,GAAG,EAAE;;AAE7B;AACA,EAAA,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,MAAM,CAACI,MAAM,EAAED,CAAC,EAAE,EAAE;AACtC,IAAA,MAAME,aAAa,GAAG,CAACL,MAAM,CAACG,CAAC,CAAC,CAACG,WAAW,IAAI,EAAE,EAAEC,OAAO;AACzD;IACA,mBAAmB,EACnB,EACF,CAAC;AAED,IAAA,IAAIF,aAAa,CAACG,IAAI,EAAE,KAAK,EAAE,EAAE;AAC/B,MAAA;AACF,IAAA;AACA;AACA;IACAH,aAAa,CACVI,KAAK,CAAC,GAAG;AACV;AAAA,KACCC,MAAM,CAAC,CAACC,IAAI,EAAEC,KAAK,EAAEC,KAAK,KAAKA,KAAK,CAACT,MAAM,GAAG,CAAC,IAAIO,IAAI,CAACH,IAAI,EAAE;AAC/D;KACCM,OAAO,CAAEH,IAAI,IAAK;AACjB;AACA;AACA;MACA,IACE,CAACA,IAAI,CAACI,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,EAAEX,MAAM,GAAG,CAAC,IACnCO,IAAI,CAACH,IAAI,EAAE,CAACQ,UAAU,CAAC,GAAG,CAAC,EAC3B;AACA,QAAA;AACF,MAAA;AAEA,MAAA,MAAMD,KAAK,GAAGJ,IAAI,CAACF,KAAK,CAAC,GAAG,CAAC;QAC3BQ,OAA+B,GAAG,EAAE;QACpCC,WAAW,GAAGH,KAAK,CAAC,CAAC,CAAC,CAACP,IAAI,EAAE;AAC7BW,QAAAA,kBAAkB,GAAGD,WAAW,CAACT,KAAK,CAAC,GAAG,CAAC,CAACC,MAAM,CAAC,UAAUU,IAAI,EAAE;AACjE,UAAA,OAAOA,IAAI,CAACZ,IAAI,EAAE;AACpB,QAAA,CAAC,CAAC;AAEJ,MAAA,KAAK,IAAIa,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,kBAAkB,CAACf,MAAM,EAAEiB,CAAC,EAAE,EAAE;QAClD,MAAMD,IAAI,GAAGD,kBAAkB,CAACE,CAAC,CAAC,CAACZ,KAAK,CAAC,GAAG,CAAC;UAC3Ca,QAAQ,GAAGF,IAAI,CAAC,CAAC,CAAC,CAACZ,IAAI,EAAE;UACzBe,KAAK,GAAGH,IAAI,CAAC,CAAC,CAAC,CAACZ,IAAI,EAAE;AACxBS,QAAAA,OAAO,CAACK,QAAQ,CAAC,GAAGC,KAAK;AAC3B,MAAA;MACAZ,IAAI,GAAGI,KAAK,CAAC,CAAC,CAAC,CAACP,IAAI,EAAE;MACtBG,IAAI,CAACF,KAAK,CAAC,GAAG,CAAC,CAACK,OAAO,CAAEU,KAAK,IAAK;AACjCA,QAAAA,KAAK,GAAGA,KAAK,CAACjB,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC,CAACC,IAAI,EAAE;QACzC,IAAIgB,KAAK,KAAK,EAAE,EAAE;AAChB,UAAA;AACF,QAAA;QACAtB,QAAQ,CAACsB,KAAK,CAAC,GAAG;AAChB,UAAA,IAAItB,QAAQ,CAACsB,KAAK,CAAC,IAAI,EAAE,CAAC;UAC1B,GAAGP;SACJ;AACH,MAAA,CAAC,CAAC;AACJ,IAAA,CAAC,CAAC;AACN,EAAA;AACA,EAAA,OAAOf,QAAQ;AACjB;;;;"}