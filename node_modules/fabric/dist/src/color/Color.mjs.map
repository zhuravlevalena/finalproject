{"version":3,"file":"Color.mjs","sources":["../../../src/color/Color.ts"],"sourcesContent":["import { normalizeWs } from '../util/internals/normalizeWhiteSpace';\nimport { radiansToDegrees } from '../util/misc/radiansDegreesConversion';\nimport { ColorNameMap } from './color_map';\nimport { reHSLa, reHex, reRGBa } from './constants';\nimport type { TRGBAColorSource, TColorArg } from './typedefs';\nimport {\n  hue2rgb,\n  hexify,\n  rgb2Hsl,\n  fromAlphaToFloat,\n  greyAverage,\n} from './util';\n\n/**\n * @class Color common color operations\n * @see {@link http://fabric5.fabricjs.com/fabric-intro-part-2#colors colors}\n */\nexport class Color {\n  declare private _source: TRGBAColorSource;\n  isUnrecognised = false;\n\n  /**\n   *\n   * @param {string} [color] optional in hex or rgb(a) or hsl format or from known color list\n   */\n  constructor(color?: TColorArg) {\n    if (!color) {\n      // we default to black as canvas does\n      this.setSource([0, 0, 0, 1]);\n    } else if (color instanceof Color) {\n      this.setSource([...color._source]);\n    } else if (Array.isArray(color)) {\n      const [r, g, b, a = 1] = color;\n      this.setSource([r, g, b, a]);\n    } else {\n      this.setSource(this._tryParsingColor(color));\n    }\n  }\n\n  /**\n   * @private\n   * @param {string} [color] Color value to parse\n   * @returns {TRGBAColorSource}\n   */\n  protected _tryParsingColor(color: string) {\n    color = color.toLowerCase();\n    if (color in ColorNameMap) {\n      color = ColorNameMap[color as keyof typeof ColorNameMap];\n    }\n    return color === 'transparent'\n      ? ([255, 255, 255, 0] as TRGBAColorSource)\n      : Color.sourceFromHex(color) ||\n          Color.sourceFromRgb(color) ||\n          Color.sourceFromHsl(color) ||\n          // color is not recognized\n          // we default to black as canvas does\n          // eslint-disable-next-line no-constant-binary-expression\n          ((this.isUnrecognised = true) && ([0, 0, 0, 1] as TRGBAColorSource));\n  }\n\n  /**\n   * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n   * @return {TRGBAColorSource}\n   */\n  getSource() {\n    return this._source;\n  }\n\n  /**\n   * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n   * @param {TRGBAColorSource} source\n   */\n  setSource(source: TRGBAColorSource) {\n    this._source = source;\n  }\n\n  /**\n   * Returns color representation in RGB format\n   * @return {String} ex: rgb(0-255,0-255,0-255)\n   */\n  toRgb() {\n    const [r, g, b] = this.getSource();\n    return `rgb(${r},${g},${b})`;\n  }\n\n  /**\n   * Returns color representation in RGBA format\n   * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\n   */\n  toRgba() {\n    return `rgba(${this.getSource().join(',')})`;\n  }\n\n  /**\n   * Returns color representation in HSL format\n   * @return {String} ex: hsl(0-360,0%-100%,0%-100%)\n   */\n  toHsl() {\n    const [h, s, l] = rgb2Hsl(...this.getSource());\n    return `hsl(${h},${s}%,${l}%)`;\n  }\n\n  /**\n   * Returns color representation in HSLA format\n   * @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)\n   */\n  toHsla() {\n    const [h, s, l, a] = rgb2Hsl(...this.getSource());\n    return `hsla(${h},${s}%,${l}%,${a})`;\n  }\n\n  /**\n   * Returns color representation in HEX format\n   * @return {String} ex: FF5555\n   */\n  toHex() {\n    const fullHex = this.toHexa();\n    return fullHex.slice(0, 6);\n  }\n\n  /**\n   * Returns color representation in HEXA format\n   * @return {String} ex: FF5555CC\n   */\n  toHexa() {\n    const [r, g, b, a] = this.getSource();\n    return `${hexify(r)}${hexify(g)}${hexify(b)}${hexify(Math.round(a * 255))}`;\n  }\n\n  /**\n   * Gets value of alpha channel for this color\n   * @return {Number} 0-1\n   */\n  getAlpha() {\n    return this.getSource()[3];\n  }\n\n  /**\n   * Sets value of alpha channel for this color\n   * @param {Number} alpha Alpha value 0-1\n   * @return {Color} thisArg\n   */\n  setAlpha(alpha: number) {\n    this._source[3] = alpha;\n    return this;\n  }\n\n  /**\n   * Transforms color to its grayscale representation\n   * @return {Color} thisArg\n   */\n  toGrayscale() {\n    this.setSource(greyAverage(this.getSource()));\n    return this;\n  }\n\n  /**\n   * Transforms color to its black and white representation\n   * @param {Number} threshold\n   * @return {Color} thisArg\n   */\n  toBlackWhite(threshold: number) {\n    const [average, , , a] = greyAverage(this.getSource()),\n      bOrW = average < (threshold || 127) ? 0 : 255;\n    this.setSource([bOrW, bOrW, bOrW, a]);\n    return this;\n  }\n\n  /**\n   * Overlays color with another color\n   * @param {String|Color} otherColor\n   * @return {Color} thisArg\n   */\n  overlayWith(otherColor: string | Color) {\n    if (!(otherColor instanceof Color)) {\n      otherColor = new Color(otherColor);\n    }\n\n    const source = this.getSource(),\n      otherAlpha = 0.5,\n      otherSource = otherColor.getSource(),\n      [R, G, B] = source.map((value, index) =>\n        Math.round(value * (1 - otherAlpha) + otherSource[index] * otherAlpha),\n      );\n\n    this.setSource([R, G, B, source[3]]);\n    return this;\n  }\n\n  /**\n   * Returns new color object, when given a color in RGB format\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255)\n   * @return {Color}\n   */\n  static fromRgb(color: string): Color {\n    return Color.fromRgba(color);\n  }\n\n  /**\n   * Returns new color object, when given a color in RGBA format\n   * @param {String} color\n   * @return {Color}\n   */\n  static fromRgba(color: string): Color {\n    return new Color(Color.sourceFromRgb(color));\n  }\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)\n   * @return {TRGBAColorSource | undefined} source\n   */\n  static sourceFromRgb(color: string): TRGBAColorSource | undefined {\n    const match = normalizeWs(color).match(reRGBa());\n    if (match) {\n      const [r, g, b] = match.slice(1, 4).map((value) => {\n        const parsedValue = parseFloat(value);\n        return value.endsWith('%')\n          ? Math.round(parsedValue * 2.55)\n          : parsedValue;\n      });\n      return [r, g, b, fromAlphaToFloat(match[4])];\n    }\n  }\n\n  /**\n   * Returns new color object, when given a color in HSL format\n   * @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)\n   * @return {Color}\n   */\n  static fromHsl(color: string): Color {\n    return Color.fromHsla(color);\n  }\n\n  /**\n   * Returns new color object, when given a color in HSLA format\n   * @param {String} color\n   * @return {Color}\n   */\n  static fromHsla(color: string): Color {\n    return new Color(Color.sourceFromHsl(color));\n  }\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.\n   * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n   * @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)\n   * @return {TRGBAColorSource | undefined} source\n   * @see http://http://www.w3.org/TR/css3-color/#hsl-color\n   */\n  static sourceFromHsl(color: string): TRGBAColorSource | undefined {\n    const match = normalizeWs(color).match(reHSLa());\n    if (!match) {\n      return;\n    }\n    const match1degrees = Color.parseAngletoDegrees(match[1]);\n\n    const h = (((match1degrees % 360) + 360) % 360) / 360,\n      s = parseFloat(match[2]) / 100,\n      l = parseFloat(match[3]) / 100;\n    let r: number, g: number, b: number;\n\n    if (s === 0) {\n      r = g = b = l;\n    } else {\n      const q = l <= 0.5 ? l * (s + 1) : l + s - l * s,\n        p = l * 2 - q;\n\n      r = hue2rgb(p, q, h + 1 / 3);\n      g = hue2rgb(p, q, h);\n      b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return [\n      Math.round(r * 255),\n      Math.round(g * 255),\n      Math.round(b * 255),\n      fromAlphaToFloat(match[4]),\n    ];\n  }\n\n  /**\n   * Returns new color object, when given a color in HEX format\n   * @param {String} color Color value ex: FF5555\n   * @return {Color}\n   */\n  static fromHex(color: string): Color {\n    return new Color(Color.sourceFromHex(color));\n  }\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HEX format\n   * @param {String} color ex: FF5555 or FF5544CC (RGBa)\n   * @return {TRGBAColorSource | undefined} source\n   */\n  static sourceFromHex(color: string): TRGBAColorSource | undefined {\n    if (color.match(reHex())) {\n      const value = color.slice(color.indexOf('#') + 1),\n        isShortNotation = value.length <= 4;\n      let expandedValue: string[];\n      if (isShortNotation) {\n        expandedValue = value.split('').map((hex) => hex + hex);\n      } else {\n        expandedValue = value.match(/.{2}/g)!;\n      }\n      const [r, g, b, a = 255] = expandedValue.map((hexCouple) =>\n        parseInt(hexCouple, 16),\n      );\n      return [r, g, b, a / 255];\n    }\n  }\n\n  /**\n   * Converts a string that could be any angle notation (50deg, 0.5turn, 2rad)\n   * into degrees without the 'deg' suffix\n   * @param {String} value ex: 0deg, 0.5turn, 2rad\n   * @return {Number} number in degrees or NaN if inputs are invalid\n   */\n  static parseAngletoDegrees(value: string): number {\n    const lowercase = value.toLowerCase();\n    const numeric = parseFloat(lowercase);\n\n    if (lowercase.includes('rad')) {\n      return radiansToDegrees(numeric);\n    }\n\n    if (lowercase.includes('turn')) {\n      return numeric * 360;\n    }\n\n    // Value is probably just a number already in degrees eg '50'\n    return numeric;\n  }\n}\n"],"names":["Color","constructor","color","_defineProperty","setSource","_source","Array","isArray","r","g","b","a","_tryParsingColor","toLowerCase","ColorNameMap","sourceFromHex","sourceFromRgb","sourceFromHsl","isUnrecognised","getSource","source","toRgb","toRgba","join","toHsl","h","s","l","rgb2Hsl","toHsla","toHex","fullHex","toHexa","slice","hexify","Math","round","getAlpha","setAlpha","alpha","toGrayscale","greyAverage","toBlackWhite","threshold","average","bOrW","overlayWith","otherColor","otherAlpha","otherSource","R","G","B","map","value","index","fromRgb","fromRgba","match","normalizeWs","reRGBa","parsedValue","parseFloat","endsWith","fromAlphaToFloat","fromHsl","fromHsla","reHSLa","match1degrees","parseAngletoDegrees","q","p","hue2rgb","fromHex","reHex","indexOf","isShortNotation","length","expandedValue","split","hex","hexCouple","parseInt","lowercase","numeric","includes","radiansToDegrees"],"mappings":"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"}