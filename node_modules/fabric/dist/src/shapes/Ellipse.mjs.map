{"version":3,"file":"Ellipse.mjs","sources":["../../../src/shapes/Ellipse.ts"],"sourcesContent":["import { SCALE_X, SCALE_Y, twoMathPi } from '../constants';\nimport { SHARED_ATTRIBUTES } from '../parser/attributes';\nimport { parseAttributes } from '../parser/parseAttributes';\nimport type { Abortable, TClassProperties, TOptions } from '../typedefs';\nimport { classRegistry } from '../ClassRegistry';\nimport { FabricObject, cacheProperties } from './Object/FabricObject';\nimport type { FabricObjectProps, SerializedObjectProps } from './Object/types';\nimport type { ObjectEvents } from '../EventTypeDefs';\nimport type { CSSRules } from '../parser/typedefs';\n\nexport const ellipseDefaultValues: Partial<TClassProperties<Ellipse>> = {\n  rx: 0,\n  ry: 0,\n};\n\ninterface UniqueEllipseProps {\n  rx: number;\n  ry: number;\n}\n\nexport interface SerializedEllipseProps\n  extends SerializedObjectProps,\n    UniqueEllipseProps {}\n\nexport interface EllipseProps extends FabricObjectProps, UniqueEllipseProps {}\n\nconst ELLIPSE_PROPS = ['rx', 'ry'] as const;\n\nexport class Ellipse<\n    Props extends TOptions<EllipseProps> = Partial<EllipseProps>,\n    SProps extends SerializedEllipseProps = SerializedEllipseProps,\n    EventSpec extends ObjectEvents = ObjectEvents,\n  >\n  extends FabricObject<Props, SProps, EventSpec>\n  implements EllipseProps\n{\n  /**\n   * Horizontal radius\n   * @type Number\n   */\n  declare rx: number;\n\n  /**\n   * Vertical radius\n   * @type Number\n   */\n  declare ry: number;\n\n  static type = 'Ellipse';\n\n  static cacheProperties = [...cacheProperties, ...ELLIPSE_PROPS];\n\n  static ownDefaults = ellipseDefaultValues;\n\n  static getDefaults(): Record<string, any> {\n    return {\n      ...super.getDefaults(),\n      ...Ellipse.ownDefaults,\n    };\n  }\n\n  /**\n   * Constructor\n   * @param {Object} [options] Options object\n   */\n  constructor(options?: Props) {\n    super();\n    Object.assign(this, Ellipse.ownDefaults);\n    this.setOptions(options);\n  }\n\n  /**\n   * @private\n   * @param {String} key\n   * @param {*} value\n   * @return {Ellipse} thisArg\n   */\n  _set(key: string, value: any) {\n    super._set(key, value);\n    switch (key) {\n      case 'rx':\n        this.rx = value;\n        this.set('width', value * 2);\n        break;\n\n      case 'ry':\n        this.ry = value;\n        this.set('height', value * 2);\n        break;\n    }\n    return this;\n  }\n\n  /**\n   * Returns horizontal radius of an object (according to how an object is scaled)\n   * @return {Number}\n   */\n  getRx() {\n    return this.get('rx') * this.get(SCALE_X);\n  }\n\n  /**\n   * Returns Vertical radius of an object (according to how an object is scaled)\n   * @return {Number}\n   */\n  getRy() {\n    return this.get('ry') * this.get(SCALE_Y);\n  }\n\n  /**\n   * Returns object representation of an instance\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {Object} object representation of an instance\n   */\n  toObject<\n    T extends Omit<Props & TClassProperties<this>, keyof SProps>,\n    K extends keyof T = never,\n  >(propertiesToInclude: K[] = []): Pick<T, K> & SProps {\n    return super.toObject([...ELLIPSE_PROPS, ...propertiesToInclude]);\n  }\n\n  /**\n   * Returns svg representation of an instance\n   * @return {Array} an array of strings with the specific svg representation\n   * of the instance\n   */\n  _toSVG(): string[] {\n    return [\n      '<ellipse ',\n      'COMMON_PARTS',\n      `cx=\"0\" cy=\"0\" rx=\"${this.rx}\" ry=\"${this.ry}\" />\\n`,\n    ];\n  }\n\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   */\n  _render(ctx: CanvasRenderingContext2D) {\n    ctx.beginPath();\n    ctx.save();\n    ctx.transform(1, 0, 0, this.ry / this.rx, 0, 0);\n    ctx.arc(0, 0, this.rx, 0, twoMathPi, false);\n    ctx.restore();\n    this._renderPaintInOrder(ctx);\n  }\n\n  /* _FROM_SVG_START_ */\n\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link Ellipse.fromElement})\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\n   */\n  static ATTRIBUTE_NAMES = [...SHARED_ATTRIBUTES, 'cx', 'cy', 'rx', 'ry'];\n\n  /**\n   * Returns {@link Ellipse} instance from an SVG element\n   * @param {HTMLElement} element Element to parse\n   * @return {Ellipse}\n   */\n  static async fromElement(\n    element: HTMLElement,\n    options?: Abortable,\n    cssRules?: CSSRules,\n  ) {\n    const parsedAttributes = parseAttributes(\n      element,\n      this.ATTRIBUTE_NAMES,\n      cssRules,\n    );\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.rx;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.ry;\n    return new this(parsedAttributes);\n  }\n\n  /* _FROM_SVG_END_ */\n}\n\nclassRegistry.setClass(Ellipse);\nclassRegistry.setSVGClass(Ellipse);\n"],"names":["ellipseDefaultValues","rx","ry","ELLIPSE_PROPS","Ellipse","FabricObject","getDefaults","ownDefaults","constructor","options","Object","assign","setOptions","_set","key","value","set","getRx","get","SCALE_X","getRy","SCALE_Y","toObject","propertiesToInclude","arguments","length","undefined","_toSVG","_render","ctx","beginPath","save","transform","arc","twoMathPi","restore","_renderPaintInOrder","fromElement","element","cssRules","parsedAttributes","parseAttributes","ATTRIBUTE_NAMES","left","top","_defineProperty","cacheProperties","SHARED_ATTRIBUTES","classRegistry","setClass","setSVGClass"],"mappings":"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"}